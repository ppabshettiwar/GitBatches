angular.module("attachmentViewModule",["toaster"]).config(["$sceDelegateProvider",function(d){var b=$("<a>",{href:application_js})[0];var c=b.protocol+"//"+b.hostname+"/**";d.resourceUrlWhitelist(["self",c])}]).directive("attachmentView",function(){return{restrict:"AE",templateUrl:application_js+"templates/attachments-viewlink.htm",scope:{},controller:["$scope","$location","$q","toaster",function(c,f,b,a){var e=f.search();c.invalidUrl=false;var d={To:e.to,AttachmentId:e.Id,Version:e.version,ExpiresOn:e.expOn,Sign:e.sign,UserAgent:navigator.userAgent};c.isValidLink=true;if(new Date(e.expOn)<new Date()){c.isValidLink=false}if(c.isValidLink){c.inprogress=true;ATT_EXP.ViewLinkController.ValidateUrl(d,function(g){c.inprogress=false;if(g!=null&&g!=undefined){if(g==false){a.pop("error","","Invalid Url!")}}c.$apply()})}c.sendPassword=function(){var h=f.search();var g={To:h.to,AttachmentId:h.Id,Version:h.version,ExpiresOn:h.expOn,Sign:h.sign,UserAgent:navigator.userAgent};c.inprogress=true;ATT_EXP.ViewLinkController.ValidateUrl(g,function(i){if(i!=null&&i!=undefined){c.inprogress=false;if(i==false){a.pop("error","","Invalid Url!")}else{c.inprogress=true;ATT_EXP.ViewLinkController.GeneratePasswordAndSendEmail(g,function(j){if(!!j){if(j=="Success"){a.pop("success","","An email has been sent to you!")}else{a.pop("error","",j)}}c.inprogress=false;c.$apply()})}c.$apply()}})};c.viewLink=function(){var h=f.search();var g={To:h.to,AttachmentId:h.Id,Version:h.version,ExpiresOn:h.expOn,Sign:h.sign,UserAgent:navigator.userAgent};c.inprogress=true;ATT_EXP.ViewLinkController.ValidateUrl(g,function(i){if(i!=null&&i!=undefined){c.inprogress=false;if(i==false){a.pop("error","","Invalid Url!")}else{c.inprogress=true;ATT_EXP.ViewLinkController.ValidatePassword(c.password.trim(),g,function(j){if(!!j){if(j!="Invalid password"&&j!="error"){window.open(j.replace(/amp;/g,""),"_blank")}else{if(j=="Invalid password"){a.pop("error","",j)}else{a.pop("error","","Some error has occured!")}}c.password=""}c.inprogress=false;c.$apply()})}c.$apply()}})}}]}});